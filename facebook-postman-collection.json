{
  "info": {
    "name": "DelightChat Facebook Integration",
    "description": "Complete workflow for Facebook channel setup and messaging",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001",
      "type": "string"
    },
    {
      "key": "ngrokUrl",
      "value": "https://43ad9a23bb45.ngrok-free.app",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "orgId",
      "value": "",
      "type": "string"
    },
    {
      "key": "channelId",
      "value": "",
      "type": "string"
    },
    {
      "key": "customerId",
      "value": "",
      "type": "string"
    },
    {
      "key": "ticketId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "1. Authentication",
      "item": [
        {
          "name": "1.1 Create Organization & Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('accessToken', response.accessToken);",
                  "    pm.collectionVariables.set('orgId', response.user.orgId);",
                  "    console.log('Organization created:', response.user.orgId);",
                  "    console.log('Access token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orgName\": \"Facebook Demo Company\",\n  \"name\": \"Admin User\",\n  \"email\": \"admin@facebookdemo.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/signup",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "signup"]
            }
          }
        },
        {
          "name": "1.2 Login (Alternative)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('accessToken', response.accessToken);",
                  "    pm.collectionVariables.set('orgId', response.user.orgId);",
                  "    console.log('Logged in successfully');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@facebookdemo.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "2. Facebook Channel Setup",
      "item": [
        {
          "name": "2.1 Create Facebook Channel",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('channelId', response.id);",
                  "    console.log('Facebook channel created:', response.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"type\": \"FACEBOOK\",\n  \"name\": \"Facebook Business Page\",\n  \"config\": {\n    \"facebookPageId\": \"780005311871882\",\n    \"pageAccessToken\": \"EAAaBWZBRyFecBP49eXOziWZBpaEQqMRZAS2uXtrGSeZC5YirtAOzBhdoynSrOPbsqQEjOGRrdJ5cCjwsWPbGmqeZCQz3n0loUMUZA7ACrgzI806BOr5ZA7LBg7YjnvZAgVueSAyLxIHl62Go0mFhQXwkV3ZAtEe66Q3ZBQtn7c9WKB5z5ziTmq7V5GxgLN99gsF24tksknLBSa4W3TckYkzBTaNjPZB9ZA3FdQjpDDTfOcCMTMcH\",\n    \"appSecret\": \"9c1835a21525dcfbd881fca719e52744\",\n    \"appId\": \"1831081534952935\",\n    \"webhookVerifyToken\": \"facebook_verify_token_123\",\n    \"webhookUrl\": \"{{ngrokUrl}}/webhook/{{channelId}}\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/channels",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "channels"]
            }
          }
        },
        {
          "name": "2.2 Get All Channels",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/channels",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "channels"]
            }
          }
        },
        {
          "name": "2.3 Get Facebook Channel Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/channels/{{channelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "channels", "{{channelId}}"]
            }
          }
        },
        {
          "name": "2.4 Test Facebook Connection",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/channels/{{channelId}}/test-connection",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "channels", "{{channelId}}", "test-connection"]
            }
          }
        }
      ]
    },
    {
      "name": "3. Webhook Setup & Testing",
      "item": [
        {
          "name": "3.1 Webhook Verification (GET)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/webhook/{{channelId}}?hub.mode=subscribe&hub.verify_token=facebook_verify_token_123&hub.challenge=test_challenge_123",
              "host": ["{{baseUrl}}"],
              "path": ["webhook", "{{channelId}}"],
              "query": [
                {
                  "key": "hub.mode",
                  "value": "subscribe"
                },
                {
                  "key": "hub.verify_token",
                  "value": "facebook_verify_token_123"
                },
                {
                  "key": "hub.challenge",
                  "value": "test_challenge_123"
                }
              ]
            }
          }
        },
        {
          "name": "3.2 Test Facebook DM (Mock Format)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"senderPhone\": \"facebook_user_123\",\n  \"senderName\": \"Jane Smith\",\n  \"message\": \"Hello! I have a question about your services\",\n  \"messageId\": \"fb_msg_123\",\n  \"metadata\": {\n    \"platform\": \"facebook\",\n    \"type\": \"direct_message\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/webhook/{{channelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["webhook", "{{channelId}}"]
            }
          }
        },
        {
          "name": "3.3 Test Facebook Real DM Format",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "x-hub-signature-256",
                "value": "sha256=test_signature"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"object\": \"page\",\n  \"entry\": [\n    {\n      \"id\": \"PAGE_ID\",\n      \"time\": 1234567890,\n      \"messaging\": [\n        {\n          \"sender\": {\n            \"id\": \"USER_ID_123\"\n          },\n          \"recipient\": {\n            \"id\": \"PAGE_ID\"\n          },\n          \"timestamp\": 1234567890,\n          \"message\": {\n            \"mid\": \"MESSAGE_ID\",\n            \"text\": \"Hi! I'm interested in your products.\"\n          }\n        }\n      ]\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/webhook/{{channelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["webhook", "{{channelId}}"]
            }
          }
        },
        {
          "name": "3.4 Test Facebook Comment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"object\": \"page\",\n  \"entry\": [\n    {\n      \"id\": \"PAGE_ID\",\n      \"time\": 1234567890,\n      \"changes\": [\n        {\n          \"field\": \"feed\",\n          \"value\": {\n            \"item\": \"comment\",\n            \"comment_id\": \"COMMENT_ID_123\",\n            \"post_id\": \"POST_ID_456\",\n            \"message\": \"Great post! Can you tell me more?\",\n            \"created_time\": 1234567890,\n            \"from\": {\n              \"name\": \"John Doe\",\n              \"id\": \"USER_ID_789\"\n            }\n          }\n        }\n      ]\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/webhook/{{channelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["webhook", "{{channelId}}"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Customer Management",
      "item": [
        {
          "name": "4.1 Get All Customers",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const customers = pm.response.json();",
                  "    if (customers.length > 0) {",
                  "        pm.collectionVariables.set('customerId', customers[0].id);",
                  "        console.log('First customer ID saved:', customers[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/customers",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "customers"]
            }
          }
        },
        {
          "name": "4.2 Get Facebook Customers Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/customers?platform=FACEBOOK",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "customers"],
              "query": [
                {
                  "key": "platform",
                  "value": "FACEBOOK"
                }
              ]
            }
          }
        },
        {
          "name": "4.3 Get Customer Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/customers/{{customerId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "customers", "{{customerId}}"]
            }
          }
        },
        {
          "name": "4.4 Get Customer Tickets",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const tickets = pm.response.json();",
                  "    if (tickets.length > 0) {",
                  "        pm.collectionVariables.set('ticketId', tickets[0].id);",
                  "        console.log('First ticket ID saved:', tickets[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/customers/{{customerId}}/tickets",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "customers", "{{customerId}}", "tickets"]
            }
          }
        },
        {
          "name": "4.5 Get Channel Customers",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/channels/{{channelId}}/customers",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "channels", "{{channelId}}", "customers"]
            }
          }
        }
      ]
    },
    {
      "name": "5. Ticket & Message Management",
      "item": [
        {
          "name": "5.1 Get All Tickets",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/tickets",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "tickets"]
            }
          }
        },
        {
          "name": "5.2 Get Facebook Tickets Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/tickets?channelId={{channelId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "tickets"],
              "query": [
                {
                  "key": "channelId",
                  "value": "{{channelId}}"
                }
              ]
            }
          }
        },
        {
          "name": "5.3 Get Ticket with Messages",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/tickets/{{ticketId}}",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "tickets", "{{ticketId}}"]
            }
          }
        },
        {
          "name": "5.4 Send Reply to Facebook Customer",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Thank you for contacting us! How can we assist you today?\",\n  \"direction\": \"OUTBOUND\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/tickets/{{ticketId}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "tickets", "{{ticketId}}", "messages"]
            }
          }
        },
        {
          "name": "5.5 Get Ticket Messages",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accessToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/orgs/{{orgId}}/tickets/{{ticketId}}/messages",
              "host": ["{{baseUrl}}"],
              "path": ["orgs", "{{orgId}}", "tickets", "{{ticketId}}", "messages"]
            }
          }
        }
      ]
    },
    {
      "name": "6. Facebook Setup Instructions",
      "item": [
        {
          "name": "Facebook Setup Guide",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "https://developers.facebook.com/docs/messenger-platform/getting-started",
              "protocol": "https",
              "host": ["developers", "facebook", "com"],
              "path": ["docs", "messenger-platform", "getting-started"]
            },
            "description": "# Facebook Integration Setup Guide\n\n## Prerequisites\n1. Facebook Page\n2. Facebook App with Messenger Platform\n\n## Required Credentials (Same as Instagram!):\n- **Facebook Page ID**: `780005311871882` ✅\n- **Page Access Token**: `EAAaBWZBRyFecBPyx3Nn...` ✅ (Same token!)\n- **App Secret**: `9c1835a21525dcfbd881fca719e52744` ✅\n- **App ID**: `1831081534952935` ✅\n- **Webhook Verify Token**: `facebook_verify_token_123`\n\n## Setup Steps:\n\n### 1. Facebook App Configuration\n- Add **Messenger** product to your existing app\n- Add **Webhooks** product\n- Subscribe to: `messages`, `messaging_postbacks`, `feed`\n\n### 2. Page Subscription\n```bash\ncurl -X POST \"https://graph.facebook.com/v18.0/1831081534952935/subscriptions\" \\\n  -d \"object=page\" \\\n  -d \"callback_url=https://43ad9a23bb45.ngrok-free.app/webhook/{channelId}\" \\\n  -d \"verify_token=facebook_verify_token_123\" \\\n  -d \"fields=messages,messaging_postbacks,feed\" \\\n  -d \"access_token={PAGE_ACCESS_TOKEN}\"\n```\n\n### 3. Test Integration\n1. Create Facebook channel using Postman\n2. Send message to your Facebook Page\n3. Comment on your Facebook posts\n4. Check customer/ticket creation\n\n## Supported Features:\n- ✅ **Messenger DMs**: Send/receive direct messages\n- ✅ **Page Comments**: Handle comments on posts\n- ✅ **Customer Auto-creation**: From Facebook interactions\n- ✅ **Real-time Notifications**: New message alerts\n\n**Note**: You can use the SAME credentials as Instagram since they share the same Facebook Page and App!"
          }
        }
      ]
    }
  ]
}